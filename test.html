<!DOCTYPE html>
<meta charset="utf-8">

<!-- 引入d3库和d3-scale-radial库 -->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-scale-radial@1.1.0/build/d3-scale-radial.min.js"></script>

<!-- 创建一个SVG容器 -->
<svg width="900" height="900" style="background-color: #FAFAFA;" font-family="sans-serif" font-size="14"></svg>

<!-- 在JavaScript中绘制堆叠极坐标图 -->
<script>
  var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height"),
      innerRadius = 155,
      outerRadius = Math.min(width, height) / 2.5,
      g = svg.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

  var x = d3.scaleBand()
      .range([0, 2 * Math.PI])
      .align(0);

  var y = d3.scaleRadial()
      .range([innerRadius, outerRadius]);

  var z = d3.scaleOrdinal()
      .range(["#f77670", "#f8a669", "#62b6cb","#aa7ddb"]);

  d3.csv("https://raw.githubusercontent.com/jenniferzhangyf/test/main/sales.csv", function(d, i, columns) {
    for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
    d.total = t;
    return d;
  }, function(error, data) {
    if (error) throw error;

    x.domain(data.map(function(d) { return d.genres; }));
    y.domain([0, d3.max(data, function(d) { return d.total; })]);
    z.domain(data.columns.slice(1));

    g.append("g")
      .selectAll("g")
      .data(d3.stack().keys(data.columns.slice(1))(data))
      .enter().append("g")
        .attr("fill", function(d) { return z(d.key); })
      .selectAll("path")
      .data(function(d) { return d; })
      .enter().append("path")
        .attr("d", d3.arc()
            .innerRadius(function(d) { return y(d[0]); })
            .outerRadius(function(d) { return y(d[1]); })
            .startAngle(function(d) { return x(d.data.genres); })
            .endAngle(function(d) { return x(d.data.genres) + x.bandwidth(); })
            .padAngle(0.1)
            .padRadius(innerRadius));

    var label = g.append("g")
      .selectAll("g")
      .data(data)
      .enter().append("g")
        .attr("text-anchor", "middle")
        .attr("transform", function(d) { return "rotate(" + ((x(d.genres) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")translate(" + innerRadius + ",0)"; });

    label.append("line")
        .attr("x2", -5)
        .attr("stroke", "#000");

      });

</script>  
